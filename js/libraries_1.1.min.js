!function(t){var a=function(){var a='<div class="colpick"><div class="colpick_color"><div class="colpick_color_overlay1"><div class="colpick_color_overlay2"><div class="colpick_selector_outer"><div class="colpick_selector_inner"></div></div></div></div></div><div class="colpick_hue"><div class="colpick_hue_arrs"><div class="colpick_hue_larr"></div><div class="colpick_hue_rarr"></div></div></div><div class="colpick_new_color"></div><div class="colpick_current_color"></div><div class="colpick_hex_field"><div class="colpick_field_letter">#</div><input type="text" maxlength="6" size="6" /></div><div class="colpick_rgb_r colpick_field"><div class="colpick_field_letter">R</div><input type="text" maxlength="3" size="3" /><div class="colpick_field_arrs"><div class="colpick_field_uarr"></div><div class="colpick_field_darr"></div></div></div><div class="colpick_rgb_g colpick_field"><div class="colpick_field_letter">G</div><input type="text" maxlength="3" size="3" /><div class="colpick_field_arrs"><div class="colpick_field_uarr"></div><div class="colpick_field_darr"></div></div></div><div class="colpick_rgb_b colpick_field"><div class="colpick_field_letter">B</div><input type="text" maxlength="3" size="3" /><div class="colpick_field_arrs"><div class="colpick_field_uarr"></div><div class="colpick_field_darr"></div></div></div><div class="colpick_hsb_h colpick_field"><div class="colpick_field_letter">H</div><input type="text" maxlength="3" size="3" /><div class="colpick_field_arrs"><div class="colpick_field_uarr"></div><div class="colpick_field_darr"></div></div></div><div class="colpick_hsb_s colpick_field"><div class="colpick_field_letter">S</div><input type="text" maxlength="3" size="3" /><div class="colpick_field_arrs"><div class="colpick_field_uarr"></div><div class="colpick_field_darr"></div></div></div><div class="colpick_hsb_b colpick_field"><div class="colpick_field_letter">B</div><input type="text" maxlength="3" size="3" /><div class="colpick_field_arrs"><div class="colpick_field_uarr"></div><div class="colpick_field_darr"></div></div></div><div class="colpick_submit"></div></div>',e={showEvent:"click",onShow:function(){},onBeforeShow:function(){},onHide:function(){},onChange:function(){},onSubmit:function(){},colorScheme:"light",color:"3289c7",livePreview:!0,flat:!1,layout:"full",submit:1,submitText:"OK",height:156},l=function(a,e){var i=c(a);t(e).data("colpick").fields.eq(1).val(i.r).end().eq(2).val(i.g).end().eq(3).val(i.b).end()},r=function(a,e){t(e).data("colpick").fields.eq(4).val(Math.round(a.h)).end().eq(5).val(Math.round(a.s)).end().eq(6).val(Math.round(a.b)).end()},n=function(a,e){t(e).data("colpick").fields.eq(0).val(d(a))},s=function(a,e){t(e).data("colpick").selector.css("backgroundColor","#"+d({h:a.h,s:100,b:100})),t(e).data("colpick").selectorIndic.css({left:parseInt(t(e).data("colpick").height*a.s/100,10),top:parseInt(t(e).data("colpick").height*(100-a.b)/100,10)})},p=function(a,e){t(e).data("colpick").hue.css("top",parseInt(t(e).data("colpick").height-t(e).data("colpick").height*a.h/360,10))},h=function(a,e){t(e).data("colpick").currentColor.css("backgroundColor","#"+d(a))},u=function(a,e){t(e).data("colpick").newColor.css("backgroundColor","#"+d(a))},f=function(a){var e,h=t(this).parent().parent();this.parentNode.className.indexOf("_hex")>0?(h.data("colpick").color=e=i(L(this.value)),l(e,h.get(0)),r(e,h.get(0))):this.parentNode.className.indexOf("_hsb")>0?(h.data("colpick").color=e=X({h:parseInt(h.data("colpick").fields.eq(4).val(),10),s:parseInt(h.data("colpick").fields.eq(5).val(),10),b:parseInt(h.data("colpick").fields.eq(6).val(),10)}),l(e,h.get(0)),n(e,h.get(0))):(h.data("colpick").color=e=o(E({r:parseInt(h.data("colpick").fields.eq(1).val(),10),g:parseInt(h.data("colpick").fields.eq(2).val(),10),b:parseInt(h.data("colpick").fields.eq(3).val(),10)})),n(e,h.get(0)),r(e,h.get(0))),s(e,h.get(0)),p(e,h.get(0)),u(e,h.get(0)),h.data("colpick").onChange.apply(h.parent(),[e,d(e),c(e),h.data("colpick").el,0])},v=function(a){t(this).parent().removeClass("colpick_focus")},g=function(){t(this).parent().parent().data("colpick").fields.parent().removeClass("colpick_focus"),t(this).parent().addClass("colpick_focus")},k=function(a){a.preventDefault?a.preventDefault():a.returnValue=!1;var e=t(this).parent().find("input").focus(),i={el:t(this).parent().addClass("colpick_slider"),max:this.parentNode.className.indexOf("_hsb_h")>0?360:this.parentNode.className.indexOf("_hsb")>0?100:255,y:a.pageY,field:e,val:parseInt(e.val(),10),preview:t(this).parent().parent().data("colpick").livePreview};t(document).mouseup(i,m),t(document).mousemove(i,_)},_=function(t){return t.data.field.val(Math.max(0,Math.min(t.data.max,parseInt(t.data.val-t.pageY+t.data.y,10)))),t.data.preview&&f.apply(t.data.field.get(0),[!0]),!1},m=function(a){return f.apply(a.data.field.get(0),[!0]),a.data.el.removeClass("colpick_slider").find("input").focus(),t(document).off("mouseup",m),t(document).off("mousemove",_),!1},b=function(a){a.preventDefault?a.preventDefault():a.returnValue=!1;var e={cal:t(this).parent(),y:t(this).offset().top};t(document).on("mouseup touchend",e,y),t(document).on("mousemove touchmove",e,x);var i="touchstart"==a.type?a.originalEvent.changedTouches[0].pageY:a.pageY;return f.apply(e.cal.data("colpick").fields.eq(4).val(parseInt(360*(e.cal.data("colpick").height-(i-e.y))/e.cal.data("colpick").height,10)).get(0),[e.cal.data("colpick").livePreview]),!1},x=function(t){var a="touchmove"==t.type?t.originalEvent.changedTouches[0].pageY:t.pageY;return f.apply(t.data.cal.data("colpick").fields.eq(4).val(parseInt(360*(t.data.cal.data("colpick").height-Math.max(0,Math.min(t.data.cal.data("colpick").height,a-t.data.y)))/t.data.cal.data("colpick").height,10)).get(0),[t.data.preview]),!1},y=function(a){return l(a.data.cal.data("colpick").color,a.data.cal.get(0)),n(a.data.cal.data("colpick").color,a.data.cal.get(0)),t(document).off("mouseup touchend",y),t(document).off("mousemove touchmove",x),!1},w=function(a){a.preventDefault?a.preventDefault():a.returnValue=!1;var e={cal:t(this).parent(),pos:t(this).offset()};e.preview=e.cal.data("colpick").livePreview,t(document).on("mouseup touchend",e,I),t(document).on("mousemove touchmove",e,M);var i;return"touchstart"==a.type?(pageX=a.originalEvent.changedTouches[0].pageX,i=a.originalEvent.changedTouches[0].pageY):(pageX=a.pageX,i=a.pageY),f.apply(e.cal.data("colpick").fields.eq(6).val(parseInt(100*(e.cal.data("colpick").height-(i-e.pos.top))/e.cal.data("colpick").height,10)).end().eq(5).val(parseInt(100*(pageX-e.pos.left)/e.cal.data("colpick").height,10)).get(0),[e.preview]),!1},M=function(t){var a;return"touchmove"==t.type?(pageX=t.originalEvent.changedTouches[0].pageX,a=t.originalEvent.changedTouches[0].pageY):(pageX=t.pageX,a=t.pageY),f.apply(t.data.cal.data("colpick").fields.eq(6).val(parseInt(100*(t.data.cal.data("colpick").height-Math.max(0,Math.min(t.data.cal.data("colpick").height,a-t.data.pos.top)))/t.data.cal.data("colpick").height,10)).end().eq(5).val(parseInt(100*Math.max(0,Math.min(t.data.cal.data("colpick").height,pageX-t.data.pos.left))/t.data.cal.data("colpick").height,10)).get(0),[t.data.preview]),!1},I=function(a){return l(a.data.cal.data("colpick").color,a.data.cal.get(0)),n(a.data.cal.data("colpick").color,a.data.cal.get(0)),t(document).off("mouseup touchend",I),t(document).off("mousemove touchmove",M),!1},C=function(a){var e=t(this).parent(),i=e.data("colpick").color;e.data("colpick").origColor=i,h(i,e.get(0)),e.data("colpick").onSubmit(i,d(i),c(i),e.data("colpick").el)},T=function(a){a.stopPropagation();var e=t("#"+t(this).data("colpickId"));e.data("colpick").onBeforeShow.apply(this,[e.get(0)]);var i=t(this).offset(),o=i.top+this.offsetHeight,c=i.left,l=S(),d=e.width();c+d>l.l+l.w&&(c-=d),e.css({left:c+"px",top:o+"px"}),0!=e.data("colpick").onShow.apply(this,[e.get(0)])&&e.show(),t("html").mousedown({cal:e},q),e.mousedown(function(t){t.stopPropagation()})},q=function(a){0!=a.data.cal.data("colpick").onHide.apply(this,[a.data.cal.get(0)])&&a.data.cal.hide(),t("html").off("mousedown",q)},S=function(){var t="CSS1Compat"==document.compatMode;return{l:window.pageXOffset||(t?document.documentElement.scrollLeft:document.body.scrollLeft),w:window.innerWidth||(t?document.documentElement.clientWidth:document.body.clientWidth)}},X=function(t){return{h:Math.min(360,Math.max(0,t.h)),s:Math.min(100,Math.max(0,t.s)),b:Math.min(100,Math.max(0,t.b))}},E=function(t){return{r:Math.min(255,Math.max(0,t.r)),g:Math.min(255,Math.max(0,t.g)),b:Math.min(255,Math.max(0,t.b))}},L=function(t){var a=6-t.length;if(a>0){for(var e=[],i=0;a>i;i++)e.push("0");e.push(t),t=e.join("")}return t},P=function(){var a=t(this).parent(),e=a.data("colpick").origColor;a.data("colpick").color=e,l(e,a.get(0)),n(e,a.get(0)),r(e,a.get(0)),s(e,a.get(0)),p(e,a.get(0)),u(e,a.get(0))};return{init:function(c){if(c=t.extend({},e,c||{}),"string"==typeof c.color)c.color=i(c.color);else if(void 0!=c.color.r&&void 0!=c.color.g&&void 0!=c.color.b)c.color=o(c.color);else{if(void 0==c.color.h||void 0==c.color.s||void 0==c.color.b)return this;c.color=X(c.color)}return this.each(function(){if(!t(this).data("colpickId")){var e=t.extend({},c);e.origColor=c.color;var i="collorpicker_"+parseInt(1e3*Math.random());t(this).data("colpickId",i);var o=t(a).attr("id",i);o.addClass("colpick_"+e.layout+(e.submit?"":" colpick_"+e.layout+"_ns")),"light"!=e.colorScheme&&o.addClass("colpick_"+e.colorScheme),o.find("div.colpick_submit").html(e.submitText).click(C),e.fields=o.find("input").change(f).blur(v).focus(g),o.find("div.colpick_field_arrs").mousedown(k).end().find("div.colpick_current_color").click(P),e.selector=o.find("div.colpick_color").on("mousedown touchstart",w),e.selectorIndic=e.selector.find("div.colpick_selector_outer"),e.el=this,e.hue=o.find("div.colpick_hue_arrs"),huebar=e.hue.parent();var d=navigator.userAgent.toLowerCase(),_="Microsoft Internet Explorer"===navigator.appName,m=_?parseFloat(d.match(/msie ([0-9]{1,}[\.0-9]{0,})/)[1]):0,x=_&&10>m,y=["#ff0000","#ff0080","#ff00ff","#8000ff","#0000ff","#0080ff","#00ffff","#00ff80","#00ff00","#80ff00","#ffff00","#ff8000","#ff0000"];if(x){var M,I;for(M=0;11>=M;M++)I=t("<div></div>").attr("style","height:8.333333%; filter:progid:DXImageTransform.Microsoft.gradient(GradientType=0,startColorstr="+y[M]+", endColorstr="+y[M+1]+'); -ms-filter: "progid:DXImageTransform.Microsoft.gradient(GradientType=0,startColorstr='+y[M]+", endColorstr="+y[M+1]+')";'),huebar.append(I)}else stopList=y.join(","),huebar.attr("style","background:-webkit-linear-gradient(top,"+stopList+"); background: -o-linear-gradient(top,"+stopList+"); background: -ms-linear-gradient(top,"+stopList+"); background:-moz-linear-gradient(top,"+stopList+"); -webkit-linear-gradient(top,"+stopList+"); background:linear-gradient(to bottom,"+stopList+"); ");o.find("div.colpick_hue").on("mousedown touchstart",b),e.newColor=o.find("div.colpick_new_color"),e.currentColor=o.find("div.colpick_current_color"),o.data("colpick",e),l(e.color,o.get(0)),r(e.color,o.get(0)),n(e.color,o.get(0)),p(e.color,o.get(0)),s(e.color,o.get(0)),h(e.color,o.get(0)),u(e.color,o.get(0)),e.flat?(o.appendTo(this).show(),o.css({position:"relative",display:"block"})):(o.appendTo(document.body),t(this).on(e.showEvent,T),o.css({position:"absolute"}))}})},showPicker:function(){return this.each(function(){t(this).data("colpickId")&&T.apply(this)})},hidePicker:function(){return this.each(function(){t(this).data("colpickId")&&t("#"+t(this).data("colpickId")).hide()})},setColor:function(a,e){if(e="undefined"==typeof e?1:e,"string"==typeof a)a=i(a);else if(void 0!=a.r&&void 0!=a.g&&void 0!=a.b)a=o(a);else{if(void 0==a.h||void 0==a.s||void 0==a.b)return this;a=X(a)}return this.each(function(){if(t(this).data("colpickId")){var i=t("#"+t(this).data("colpickId"));i.data("colpick").color=a,i.data("colpick").origColor=a,l(a,i.get(0)),r(a,i.get(0)),n(a,i.get(0)),p(a,i.get(0)),s(a,i.get(0)),u(a,i.get(0)),i.data("colpick").onChange.apply(i.parent(),[a,d(a),c(a),i.data("colpick").el,1]),e&&h(a,i.get(0))}})}}}(),e=function(t){var t=parseInt(t.indexOf("#")>-1?t.substring(1):t,16);return{r:t>>16,g:(65280&t)>>8,b:255&t}},i=function(t){return o(e(t))},o=function(t){var a={h:0,s:0,b:0},e=Math.min(t.r,t.g,t.b),i=Math.max(t.r,t.g,t.b),o=i-e;return a.b=i,a.s=0!=i?255*o/i:0,0!=a.s?t.r==i?a.h=(t.g-t.b)/o:t.g==i?a.h=2+(t.b-t.r)/o:a.h=4+(t.r-t.g)/o:a.h=-1,a.h*=60,a.h<0&&(a.h+=360),a.s*=100/255,a.b*=100/255,a},c=function(t){var a={},e=t.h,i=255*t.s/100,o=255*t.b/100;if(0==i)a.r=a.g=a.b=o;else{var c=o,l=(255-i)*o/255,d=(c-l)*(e%60)/60;360==e&&(e=0),60>e?(a.r=c,a.b=l,a.g=l+d):120>e?(a.g=c,a.b=l,a.r=c-d):180>e?(a.g=c,a.r=l,a.b=l+d):240>e?(a.b=c,a.r=l,a.g=c-d):300>e?(a.b=c,a.g=l,a.r=l+d):360>e?(a.r=c,a.g=l,a.b=c-d):(a.r=0,a.g=0,a.b=0)}return{r:Math.round(a.r),g:Math.round(a.g),b:Math.round(a.b)}},l=function(a){var e=[a.r.toString(16),a.g.toString(16),a.b.toString(16)];return t.each(e,function(t,a){1==a.length&&(e[t]="0"+a)}),e.join("")},d=function(t){return l(c(t))};t.fn.extend({colpick:a.init,colpickHide:a.hidePicker,colpickShow:a.showPicker,colpickSetColor:a.setColor}),t.extend({colpick:{rgbToHex:l,rgbToHsb:o,hsbToHex:d,hsbToRgb:c,hexToHsb:i,hexToRgb:e}})}(jQuery);

/*! rangeslider.js - v0.3.7 | (c) 2014 @andreruffert | MIT license | https://github.com/andreruffert/rangeslider.js */
!function(a){"use strict";"function"==typeof define&&define.amd?define(["jquery"],a):a("object"==typeof exports?require("jquery"):jQuery)}(function(a){"use strict";function b(){var a=document.createElement("input");return a.setAttribute("type","range"),"text"!==a.type}function c(a,b){var c=Array.prototype.slice.call(arguments,2);return setTimeout(function(){return a.apply(null,c)},b)}function d(a,b){return b=b||100,function(){if(!a.debouncing){var c=Array.prototype.slice.apply(arguments);a.lastReturnVal=a.apply(window,c),a.debouncing=!0}return clearTimeout(a.debounceTimeout),a.debounceTimeout=setTimeout(function(){a.debouncing=!1},b),a.lastReturnVal}}function e(a){return 0!==a.offsetWidth||0!==a.offsetHeight?!1:!0}function f(a){for(var b=[],c=a.parentNode;e(c);)b.push(c),c=c.parentNode;return b}function g(a,b){var c=f(a),d=c.length,e=[],g=a[b];if(d){for(var h=0;d>h;h++)e[h]=c[h].style.display,c[h].style.display="block",c[h].style.height="0",c[h].style.overflow="hidden",c[h].style.visibility="hidden";g=a[b];for(var i=0;d>i;i++)c[i].style.display=e[i],c[i].style.height="",c[i].style.overflow="",c[i].style.visibility=""}return g}function h(b,e){if(this.$window=a(window),this.$document=a(document),this.$element=a(b),this.options=a.extend({},m,e),this._defaults=m,this._name=i,this.startEvent=this.options.startEvent.join("."+i+" ")+"."+i,this.moveEvent=this.options.moveEvent.join("."+i+" ")+"."+i,this.endEvent=this.options.endEvent.join("."+i+" ")+"."+i,this.polyfill=this.options.polyfill,this.onInit=this.options.onInit,this.onSlide=this.options.onSlide,this.onSlideEnd=this.options.onSlideEnd,this.polyfill&&l)return!1;this.identifier="js-"+i+"-"+k++,this.min=parseFloat(this.$element[0].getAttribute("min")||0),this.max=parseFloat(this.$element[0].getAttribute("max")||100),this.value=parseFloat(this.$element[0].value||this.min+(this.max-this.min)/2),this.step=parseFloat(this.$element[0].getAttribute("step")||1),this.toFixed=(this.step+"").replace(".","").length-1,this.$fill=a('<div class="'+this.options.fillClass+'" />'),this.$handle=a('<div class="'+this.options.handleClass+'" />'),this.$range=a('<div class="'+this.options.rangeClass+'" id="'+this.identifier+'" />').insertAfter(this.$element).prepend(this.$fill,this.$handle),this.$element.css({position:"absolute",width:"1px",height:"1px",overflow:"hidden",opacity:"0"}),this.handleDown=a.proxy(this.handleDown,this),this.handleMove=a.proxy(this.handleMove,this),this.handleEnd=a.proxy(this.handleEnd,this),this.init();var f=this;this.$window.on("resize."+i,d(function(){c(function(){f.update()},300)},20)),this.$document.on(this.startEvent,"#"+this.identifier+":not(."+this.options.disabledClass+")",this.handleDown),this.$element.on("change."+i,function(a,b){if(!b||b.origin!==i){var c=a.target.value,d=f.getPositionFromValue(c);f.setPosition(d)}})}var i="rangeslider",j=[],k=0,l=b(),m={polyfill:!0,rangeClass:"rangeslider",disabledClass:"rangeslider--disabled",fillClass:"rangeslider__fill",handleClass:"rangeslider__handle",startEvent:["mousedown","touchstart","pointerdown"],moveEvent:["mousemove","touchmove","pointermove"],endEvent:["mouseup","touchend","pointerup"]};h.prototype.init=function(){this.onInit&&"function"==typeof this.onInit&&this.onInit(),this.update()},h.prototype.update=function(){this.handleWidth=g(this.$handle[0],"offsetWidth"),this.rangeWidth=g(this.$range[0],"offsetWidth"),this.maxHandleX=this.rangeWidth-this.handleWidth,this.grabX=this.handleWidth/2,this.position=this.getPositionFromValue(this.value),this.$element[0].disabled?this.$range.addClass(this.options.disabledClass):this.$range.removeClass(this.options.disabledClass),this.setPosition(this.position)},h.prototype.handleDown=function(a){if(a.preventDefault(),this.$document.on(this.moveEvent,this.handleMove),this.$document.on(this.endEvent,this.handleEnd),!((" "+a.target.className+" ").replace(/[\n\t]/g," ").indexOf(this.options.handleClass)>-1)){var b=this.getRelativePosition(a),c=this.$range[0].getBoundingClientRect().left,d=this.getPositionFromNode(this.$handle[0])-c;this.setPosition(b-this.grabX),b>=d&&b<d+this.handleWidth&&(this.grabX=b-d)}},h.prototype.handleMove=function(a){a.preventDefault();var b=this.getRelativePosition(a);this.setPosition(b-this.grabX)},h.prototype.handleEnd=function(a){a.preventDefault(),this.$document.off(this.moveEvent,this.handleMove),this.$document.off(this.endEvent,this.handleEnd),this.onSlideEnd&&"function"==typeof this.onSlideEnd&&this.onSlideEnd(this.position,this.value)},h.prototype.cap=function(a,b,c){return b>a?b:a>c?c:a},h.prototype.setPosition=function(a){var b,c;b=this.getValueFromPosition(this.cap(a,0,this.maxHandleX)),c=this.getPositionFromValue(b),this.$fill[0].style.width=c+this.grabX+"px",this.$handle[0].style.left=c+"px",this.setValue(b),this.position=c,this.value=b,this.onSlide&&"function"==typeof this.onSlide&&this.onSlide(c,b)},h.prototype.getPositionFromNode=function(a){for(var b=0;null!==a;)b+=a.offsetLeft,a=a.offsetParent;return b},h.prototype.getRelativePosition=function(a){var b=this.$range[0].getBoundingClientRect().left,c=0;return"undefined"!=typeof a.pageX?c=a.pageX:"undefined"!=typeof a.originalEvent.clientX?c=a.originalEvent.clientX:a.originalEvent.touches&&a.originalEvent.touches[0]&&"undefined"!=typeof a.originalEvent.touches[0].clientX?c=a.originalEvent.touches[0].clientX:a.currentPoint&&"undefined"!=typeof a.currentPoint.x&&(c=a.currentPoint.x),c-b},h.prototype.getPositionFromValue=function(a){var b,c;return b=(a-this.min)/(this.max-this.min),c=b*this.maxHandleX},h.prototype.getValueFromPosition=function(a){var b,c;return b=a/(this.maxHandleX||1),c=this.step*Math.round(b*(this.max-this.min)/this.step)+this.min,Number(c.toFixed(this.toFixed))},h.prototype.setValue=function(a){a!==this.value&&this.$element.val(a).trigger("change",{origin:i})},h.prototype.destroy=function(){this.$document.off(this.startEvent,"#"+this.identifier,this.handleDown),this.$element.off("."+i).removeAttr("style").removeData("plugin_"+i),this.$range&&this.$range.length&&this.$range[0].parentNode.removeChild(this.$range[0]),j.splice(j.indexOf(this.$element[0]),1),j.length||this.$window.off("."+i)},a.fn[i]=function(b){return this.each(function(){var c=a(this),d=c.data("plugin_"+i);d||(c.data("plugin_"+i,d=new h(this,b)),j.push(this)),"string"==typeof b&&d[b]()})}});

function generateFlatIconFromImage(e){loadToCanvas(e,function(e){lastCroppedIconCanvas=cropVisibleImageToNewCanvas(e);var a=lastCroppedIconCanvas.width*padding+lastCroppedIconCanvas.width,n=lastCroppedIconCanvas.height*padding+lastCroppedIconCanvas.height;lastIconBackground=createIconBackground(diameterForDimensions(a,n)),lastPaddedIconCanvas=centerCanvas(lastCroppedIconCanvas,lastIconBackground.width,lastIconBackground.height),lastUnmergedIconCanvas=drawShadow(lastPaddedIconCanvas,shadowAngle),lastMergedIconCanvas=mergeIconWithBackground(lastUnmergedIconCanvas,lastIconBackground),updatePreview(),downloadDisabled&&(downloadButton.classList.remove("disabled"),downloadDisabled=!1)})}function updateCurrentPadding(){if(padding=paddingPicker.value,null!=lastCroppedIconCanvas){var e=lastCroppedIconCanvas.width*padding+lastCroppedIconCanvas.width,a=lastCroppedIconCanvas.height*padding+lastCroppedIconCanvas.height;lastIconBackground=createIconBackground(diameterForDimensions(e,a)),lastPaddedIconCanvas=centerCanvas(lastCroppedIconCanvas,lastIconBackground.width,lastIconBackground.height),lastUnmergedIconCanvas=drawShadow(lastPaddedIconCanvas,anglePicker.value),lastMergedIconCanvas=mergeIconWithBackground(lastUnmergedIconCanvas,lastIconBackground),updatePreview()}}function updateCurrentShadow(){shadowAngle=anglePicker.value,shadowOpacity=opacityPicker.value,shadowLength=lengthPicker.value,null!=lastPaddedIconCanvas&&(lastUnmergedIconCanvas=drawShadow(lastPaddedIconCanvas,shadowAngle),lastMergedIconCanvas=mergeIconWithBackground(lastUnmergedIconCanvas,lastIconBackground),updatePreview())}function updateCurrentBackground(){null!=lastUnmergedIconCanvas&&(lastIconBackground=createIconBackground(lastUnmergedIconCanvas.width),lastMergedIconCanvas=mergeIconWithBackground(lastUnmergedIconCanvas,lastIconBackground),updatePreview())}function updatePreview(){previewContext.scale(1/lastScaleFactor,1/lastScaleFactor),previewContext.clearRect(0,0,previewCanvas.width,previewCanvas.height),lastScaleFactor=previewCanvas.width/lastMergedIconCanvas.width,previewContext.scale(lastScaleFactor,lastScaleFactor),previewContext.drawImage(lastMergedIconCanvas,0,0)}function downloadIcon(e){downloadDisabled||(e.href=lastMergedIconCanvas.toDataURL(),e.download="icon.png")}function loadToCanvas(e,a){var n=new Image;n.onload=function(){a(n)},n.src=e}function cropVisibleImageToNewCanvas(e){var a=document.createElement("canvas"),n=a.getContext("2d");a.width=e.width,a.height=e.height,n.drawImage(e,0,0);for(var t=e.width,o=e.height,d=a.getContext("2d").getImageData(0,0,t,o),r=d.data,c=t,l=o,i=0,s=0,g=0;o>g;g++)for(var u=0;t>u;u++){var v=r[4*(t*g+u)+3];v>0&&(c>u&&(c=u),u>i&&(i=u),l>g&&(l=g),g>s&&(s=g))}var h=i-c+1,p=s-l+1,I=document.createElement("canvas");return I.width=h,I.height=p,I.getContext("2d").drawImage(e,c,l,h,p,0,0,h,p),I}function createIconBackground(e){var a=document.createElement("canvas");a.width=e,a.height=e;var n=a.getContext("2d");return n.fillStyle=defaultIconColor,"circle"==shapePicker.value?(n.arc(e/2,e/2,e/2,0,2*Math.PI),n.fill()):n.fillRect(0,0,e,e),a}function centerCanvas(e,a,n){var t=document.createElement("canvas");t.width=a,t.height=n;var o=.5*(a-e.width),d=.5*(n-e.height);return t.getContext("2d").drawImage(e,o,d),t}function drawShadow(e,a){var n=e.width,t=e.getContext("2d"),o=.0174532925,d=Math.tan(a*o),r=document.createElement("canvas"),c=r.getContext("2d");r.width=n,r.height=n,c.drawImage(e,0,0),c.imageSmoothingEnabled=!0;for(var l=1;n/2*shadowLength>l;l++){c.drawImage(e,l,d*l);var i=(l-1)*d;if(d*l>1)for(;l*d>i&&n>i;)c.drawImage(e,l,i),i++}for(var s=c.getImageData(0,0,n,n),g=s.data,u=t.getImageData(0,0,n,n),v=u.data,l=0,h=g.length;h>l;l+=4){g[l]=v[l],g[l+1]=v[l+1],g[l+2]=v[l+2];var p=g[l+3]/255,I=v[l+3]/255;1==p&&1==I?g[l+3]=v[l+3]:g[l+3]=v[l+3]+shadowOpacity*g[l+3]}return c.putImageData(s,0,0),r}function mergeIconWithBackground(e,a){for(var n=e.width,t=e.getContext("2d"),o=t.getImageData(0,0,n,n),d=o.data,r=a.getContext("2d"),c=r.getImageData(0,0,n,n),l=c.data,i=0,s=l.length;s>i;i+=4){var g=d[i+3]/255,u=l[i+3]/255;u>0&&g>0&&(1==g&&1==u?(l[i]=d[i],l[i+1]=d[i+1],l[i+2]=d[i+2],l[i+3]=d[i+3]):(l[i]=d[i]+(1-g)*l[i],l[i+1]=d[i+1]+(1-g)*l[i+1],l[i+2]=d[i+2]+(1-g)*l[i+2],l[i+3]=d[i+3]+(1-g)*l[i+3]))}var v=document.createElement("canvas");return v.width=n,v.height=n,v.getContext("2d").putImageData(c,0,0),v}function diameterForDimensions(e,a){return Math.sqrt(e*e+a*a)}function handleFileSelect(e){handleDragExit(e),e.stopPropagation(),e.preventDefault();for(var a,n=e.dataTransfer?e.dataTransfer.files:e.target.files,t=0;a=n[t];t++)if(a.type.match("image.*")){var o=new FileReader;o.onload=function(e){return function(e){generateFlatIconFromImage(e.target.result)}}(a),o.readAsDataURL(a)}}function handleDragEnter(e){cancelEvent(e),counter++,document.getElementById("drop_zone").classList.add("dropping")}function handleDragExit(e){cancelEvent(e),counter--,0===counter&&document.getElementById("drop_zone").classList.remove("dropping")}function cancelEvent(e){e.preventDefault()}function triggerFileUpload(){document.getElementById("files").click()}function initControls(){$(colorPicker).colpick({color:defaultIconColor,layout:"hex",submit:0,colorScheme:"dark",onChange:function(e,a,n,t,o){$(t).css("border-color","#"+a),defaultIconColor="#"+a,updateCurrentBackground(),o||$(t).val(a)}}).keyup(function(){$(this).colpickSetColor(this.value)}),$(opacityPicker).rangeslider({polyfill:!1,onSlide:function(e,a){updateCurrentShadow()}}),$(lengthPicker).rangeslider({polyfill:!1,onSlide:function(e,a){updateCurrentShadow()}}),$(anglePicker).rangeslider({polyfill:!1,onSlide:function(e,a){updateCurrentShadow()}}),$(paddingPicker).rangeslider({polyfill:!1,onSlide:function(e,a){updateCurrentPadding()}}),shapePicker.onchange=function(){updateCurrentBackground()}}function setupPlaceholder(){previewContext.fillStyle="rgb(200, 200, 200)",previewContext.fillRect(0,0,previewCanvas.width,previewCanvas.height),previewContext.fillStyle="rgb(150, 150, 150)",previewContext.font="16px Helvetica",previewContext.fillText("PREVIEW",120,150)}function setupIconLibrarySelectionListener(){$("li[class^=ion]").click(function(e){var a=e.target,n=a.classList[0].slice(4);$("#IconLibraryModal").modal("hide"),generateFlatIconFromImage("/img/ionicons/"+n+".png")})}function setupFileListener(){var e=document.getElementById("drop_zone");e.addEventListener("dragover",cancelEvent,!1),e.addEventListener("dragenter",handleDragEnter,!1),e.addEventListener("dragleave",handleDragExit,!1),e.addEventListener("drop",handleFileSelect,!1),document.getElementById("files").addEventListener("change",handleFileSelect,!1)}var previewCanvas=document.getElementById("canvas"),previewContext=canvas.getContext("2d"),downloadButton=document.getElementById("download"),colorPicker=document.getElementById("colorPicker"),shapePicker=document.getElementById("shapePicker"),paddingPicker=document.getElementById("paddingPicker"),anglePicker=document.getElementById("anglePicker"),opacityPicker=document.getElementById("opacityPicker"),lengthPicker=document.getElementById("lengthPicker"),defaultIconColor="hsl(168, 76%, 42%)",downloadDisabled=!0,shadowOpacity=.3,shadowLength=1,shadowAngle=45,padding=0,lastCroppedIconCanvas,lastIconBackground,lastPaddedIconCanvas,lastUnmergedIconCanvas,lastMergedIconCanvas,lastScaleFactor,counter=0;window.addEventListener("load",function(){initControls(),setupPlaceholder(),setupFileListener(),setupIconLibrarySelectionListener()});